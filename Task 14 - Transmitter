#include <Arduino.h>

static const uint8_t K1 = 0x5A;  
static const uint8_t K2 = 0xC3;   
static const uint8_t NONCE = 0x9D;

static inline uint8_t xorshift8(uint8_t x) {
  x ^= (uint8_t)(x << 3);
  x ^= (uint8_t)(x >> 5);
  x ^= (uint8_t)(x << 1);
  return x;
}

static inline uint8_t keystream(uint8_t ctr) {
  uint8_t s = (uint8_t)((NONCE ^ K1) + ctr);
  s = xorshift8(s);
  s = xorshift8(s);
  s = xorshift8(s);
  return (uint8_t)(s ^ K2);
}

void setup() { Serial.begin(9600); }

void loop() {
  static uint8_t counter = 0;
  uint8_t ks = keystream(counter);
  uint8_t c  = (uint8_t)(counter ^ ks);

  Serial.write(c);
  counter++;
  delay(100);
}
