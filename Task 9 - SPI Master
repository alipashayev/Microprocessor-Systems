#include <avr/io.h>
#include <util/delay.h>

uint8_t values[3] = {85, 170, 255};

void spi_master_init(void)
{
  // MOSI (PB3), SCK (PB5), SS (PB2) => OUTPUT
  DDRB |= (1 << PB3) | (1 << PB5) | (1 << PB2);

  // MISO (PB4) => INPUT
  DDRB &= ~(1 << PB4);

  // SS HIGH (inactive)
  PORTB |= (1 << PB2);

  // SPI Enable, Master, clock = fosc/16
  SPCR = (1 << SPE) | (1 << MSTR) | (1 << SPR0);
}

void spi_master_transmit(uint8_t data)
{
  PORTB &= ~(1 << PB2);

  SPDR = data;                        
  while (!(SPSR & (1 << SPIF)));       

  // SS HIGH â†’ end communication
  PORTB |= (1 << PB2);
}

void setup()
{
  spi_master_init();
}

void loop()
{
  for (uint8_t i = 0; i < 3; i++)
  {
    spi_master_transmit(values[i]);
    _delay_ms(1000);   
  }
}
